{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { existsSync, readFileSync } from \"node:fs\";\nimport type {\n\tHtml,\n\tInlineCode,\n\tLink,\n\tRoot,\n\tTable,\n\tTableCell,\n\tTableRow,\n\tText,\n} from \"mdast\";\nimport { toString as mdastToString } from \"mdast-util-to-string\";\nimport micromatch from \"micromatch\";\nimport { dirname, join } from \"pathe\";\nimport resolveWorkspacePkg from \"resolve-workspace-root\";\nimport { globSync } from \"tinyglobby\";\nimport type { Plugin } from \"unified\";\nimport type { VFile } from \"vfile\";\n\nconst { getWorkspaceGlobs, resolveWorkspaceRoot } = resolveWorkspacePkg;\n\nconst LEADING_SLASH = /^\\//;\n\n/** Available column types for the workspace packages table. */\nexport type ColumnType = \"name\" | \"description\" | \"path\" | \"private\";\n\n/**\n * A package entry discovered from the workspace.\n */\nexport interface PackageEntry {\n\t/** Package name from package.json */\n\tname: string;\n\t/** Package description from package.json */\n\tdescription: string;\n\t/** Relative path to the package directory */\n\tpath: string;\n\t/** Whether the package is private */\n\tprivate: boolean;\n}\n\n/**\n * Options for the remark-workspace-packages plugin.\n */\nexport interface WorkspacePackagesOptions {\n\t/**\n\t * Path to the workspace root relative to the markdown file's directory.\n\t * If not specified, the plugin searches upward for pnpm-workspace.yaml or package.json with workspaces.\n\t * @default undefined (auto-detect)\n\t */\n\tworkspaceRoot?: string;\n\n\t/**\n\t * Prefix for section markers.\n\t * Results in `<!-- {prefix}-start -->` and `<!-- {prefix}-end -->`\n\t * @default \"workspace-packages\"\n\t */\n\tsectionPrefix?: string;\n\n\t/**\n\t * Glob patterns to exclude packages from the table. Matches against package names.\n\t * @default []\n\t */\n\texclude?: string[];\n\n\t/**\n\t * Glob patterns to include packages in the table. If specified, only matching packages are included.\n\t * @default [] (include all)\n\t */\n\tinclude?: string[];\n\n\t/**\n\t * Whether to include private packages.\n\t * @default true\n\t */\n\tincludePrivate?: boolean;\n\n\t/**\n\t * Whether to include a link to the package directory.\n\t * @default true\n\t */\n\tincludeLinks?: boolean;\n\n\t/**\n\t * Column configuration for the table.\n\t * Use \"private\" column to show package privacy status (checkmark for private, empty for public).\n\t * @default [\"name\", \"description\"]\n\t */\n\tcolumns?: ColumnType[];\n\n\t/**\n\t * Custom column headers.\n\t * @default { name: \"Package\", description: \"Description\", path: \"Path\", private: \"Private\" }\n\t */\n\tcolumnHeaders?: Partial<Record<ColumnType, string>>;\n}\n\ninterface PackageJson {\n\tname?: string;\n\tdescription?: string;\n\tprivate?: boolean;\n\tworkspaces?: string[] | { packages: string[] };\n}\n\nfunction matchesPatterns(\n\tname: string,\n\tpatterns: string[],\n\tdefaultIfEmpty: boolean,\n): boolean {\n\tif (patterns.length === 0) {\n\t\treturn defaultIfEmpty;\n\t}\n\treturn micromatch.isMatch(name, patterns);\n}\n\nfunction expandWorkspacePatterns(\n\tworkspaceRoot: string,\n\tpatterns: string[],\n): string[] {\n\tconst globPatterns = patterns\n\t\t.filter((p) => !p.startsWith(\"!\"))\n\t\t.map((p) => join(p, \"package.json\"));\n\n\tconst packageJsonPaths = globSync(globPatterns, {\n\t\tcwd: workspaceRoot,\n\t\tabsolute: true,\n\t\tignore: [\"**/node_modules/**\"],\n\t});\n\n\treturn packageJsonPaths.map((p) => dirname(p));\n}\n\nfunction readPackageInfo(\n\tpackageDir: string,\n\tworkspaceRoot: string,\n): PackageEntry | undefined {\n\tconst pkgJsonPath = join(packageDir, \"package.json\");\n\tif (!existsSync(pkgJsonPath)) {\n\t\treturn undefined;\n\t}\n\n\ttry {\n\t\tconst content = readFileSync(pkgJsonPath, \"utf-8\");\n\t\tconst pkg = JSON.parse(content) as PackageJson;\n\n\t\tif (!pkg.name) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst relativePath = packageDir\n\t\t\t.replace(workspaceRoot, \"\")\n\t\t\t.replace(LEADING_SLASH, \"\");\n\n\t\treturn {\n\t\t\tname: pkg.name,\n\t\t\tdescription: pkg.description ?? \"\",\n\t\t\tpath: relativePath,\n\t\t\tprivate: pkg.private === true,\n\t\t};\n\t} catch {\n\t\treturn undefined;\n\t}\n}\n\nfunction extractWorkspacePackages(\n\tworkspaceRoot: string,\n\toptions: {\n\t\texclude: string[];\n\t\tinclude: string[];\n\t\tincludePrivate: boolean;\n\t},\n): PackageEntry[] {\n\tconst patterns = getWorkspaceGlobs(workspaceRoot);\n\tif (patterns === null || patterns.length === 0) {\n\t\treturn [];\n\t}\n\n\tconst packageDirs = expandWorkspacePatterns(workspaceRoot, patterns);\n\tconst packages: PackageEntry[] = [];\n\n\tfor (const dir of packageDirs) {\n\t\tconst pkg = readPackageInfo(dir, workspaceRoot);\n\t\tif (!pkg) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst isExcluded = matchesPatterns(pkg.name, options.exclude, false);\n\t\tconst isIncluded = matchesPatterns(pkg.name, options.include, true);\n\t\tconst isPrivateAndExcluded = !options.includePrivate && pkg.private;\n\n\t\tif (isPrivateAndExcluded || isExcluded || !isIncluded) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tpackages.push(pkg);\n\t}\n\n\treturn packages.sort((a, b) => a.name.localeCompare(b.name));\n}\n\ninterface MarkerIndices {\n\tstartIndex: number | null;\n\tendIndex: number | null;\n}\n\nfunction findMarkers(tree: Root, prefix: string): MarkerIndices {\n\tconst startMarker = `<!-- ${prefix}-start -->`;\n\tconst endMarker = `<!-- ${prefix}-end -->`;\n\n\tlet startIndex: number | null = null;\n\tlet endIndex: number | null = null;\n\n\tfor (let i = 0; i < tree.children.length; i++) {\n\t\tconst node = tree.children[i];\n\t\tif (node?.type === \"html\") {\n\t\t\tconst value = node.value.trim();\n\t\t\tif (value === startMarker) {\n\t\t\t\tstartIndex = i;\n\t\t\t} else if (value === endMarker) {\n\t\t\t\tendIndex = i;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn { startIndex, endIndex };\n}\n\nfunction extractRowData(\n\trow: TableRow,\n): { name: string; description: string } | undefined {\n\tconst [nameCell, descCell] = row.children;\n\tif (!(nameCell && descCell)) {\n\t\treturn undefined;\n\t}\n\n\tconst name = mdastToString(nameCell).trim();\n\tif (!name) {\n\t\treturn undefined;\n\t}\n\n\tconst description = mdastToString(descCell).trim();\n\tconst cleanName = name.replace(/^`|`$/g, \"\").replace(/^\\[|\\].*$/g, \"\");\n\treturn { name: cleanName, description };\n}\n\nfunction parseExistingTable(\n\ttree: Root,\n\tstartIndex: number,\n\tendIndex: number,\n): Map<string, string> {\n\tconst descriptions = new Map<string, string>();\n\n\tfor (let i = startIndex + 1; i < endIndex; i++) {\n\t\tconst node = tree.children[i];\n\t\tif (node?.type === \"table\") {\n\t\t\tconst tableNode = node as Table;\n\t\t\t// Skip header row (index 0), process data rows\n\t\t\tfor (const row of tableNode.children.slice(1)) {\n\t\t\t\tconst data = extractRowData(row);\n\t\t\t\tif (data) {\n\t\t\t\t\tdescriptions.set(data.name, data.description);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn descriptions;\n}\n\nfunction createTextCell(text: string): TableCell {\n\treturn {\n\t\ttype: \"tableCell\",\n\t\tchildren: [{ type: \"text\", value: text } as Text],\n\t};\n}\n\nfunction createCodeCell(code: string): TableCell {\n\treturn {\n\t\ttype: \"tableCell\",\n\t\tchildren: [{ type: \"inlineCode\", value: code } as InlineCode],\n\t};\n}\n\nfunction createLinkCell(text: string, url: string): TableCell {\n\treturn {\n\t\ttype: \"tableCell\",\n\t\tchildren: [\n\t\t\t{\n\t\t\t\ttype: \"link\",\n\t\t\t\turl,\n\t\t\t\tchildren: [{ type: \"inlineCode\", value: text } as InlineCode],\n\t\t\t} as Link,\n\t\t],\n\t};\n}\n\n/** Moves \"private\" column to second position (after \"name\") if present. */\nfunction normalizeColumnOrder(columns: ColumnType[]): ColumnType[] {\n\tconst privateIndex = columns.indexOf(\"private\");\n\tif (privateIndex === -1 || privateIndex === 1) {\n\t\treturn columns;\n\t}\n\n\tconst result: ColumnType[] = columns.filter((col) => col !== \"private\");\n\tresult.splice(1, 0, \"private\");\n\treturn result;\n}\n\ninterface TableGenerationOptions {\n\tcolumns: ColumnType[];\n\tcolumnHeaders: Record<ColumnType, string>;\n\tincludeLinks: boolean;\n}\n\nfunction createCellForColumn(\n\tcol: ColumnType,\n\tentry: PackageEntry,\n\texistingDescriptions: Map<string, string>,\n\tincludeLinks: boolean,\n): TableCell {\n\tswitch (col) {\n\t\tcase \"name\":\n\t\t\treturn includeLinks\n\t\t\t\t? createLinkCell(entry.name, `./${entry.path}`)\n\t\t\t\t: createCodeCell(entry.name);\n\t\tcase \"description\":\n\t\t\treturn createTextCell(\n\t\t\t\texistingDescriptions.get(entry.name) ?? entry.description,\n\t\t\t);\n\t\tcase \"path\":\n\t\t\treturn createCodeCell(entry.path);\n\t\tcase \"private\":\n\t\t\treturn createTextCell(entry.private ? \"âœ“\" : \"\");\n\t\tdefault: {\n\t\t\tconst exhaustiveCheck: never = col;\n\t\t\tthrow new Error(`Unknown column type: ${exhaustiveCheck}`);\n\t\t}\n\t}\n}\n\nfunction generateTableAst(\n\tentries: PackageEntry[],\n\texistingDescriptions: Map<string, string>,\n\toptions: TableGenerationOptions,\n): Table {\n\tconst columns = normalizeColumnOrder(options.columns);\n\n\tconst headerRow: TableRow = {\n\t\ttype: \"tableRow\",\n\t\tchildren: columns.map((col) => createTextCell(options.columnHeaders[col])),\n\t};\n\n\tconst dataRows: TableRow[] = entries.map((entry) => ({\n\t\ttype: \"tableRow\",\n\t\tchildren: columns.map((col) =>\n\t\t\tcreateCellForColumn(\n\t\t\t\tcol,\n\t\t\t\tentry,\n\t\t\t\texistingDescriptions,\n\t\t\t\toptions.includeLinks,\n\t\t\t),\n\t\t),\n\t}));\n\n\treturn {\n\t\ttype: \"table\",\n\t\talign: columns.map(() => null),\n\t\tchildren: [headerRow, ...dataRows],\n\t};\n}\n\nfunction updateAst(\n\ttree: Root,\n\ttable: Table,\n\tprefix: string,\n\tmarkers: MarkerIndices,\n): void {\n\tconst startMarkerNode: Html = {\n\t\ttype: \"html\",\n\t\tvalue: `<!-- ${prefix}-start -->`,\n\t};\n\tconst endMarkerNode: Html = {\n\t\ttype: \"html\",\n\t\tvalue: `<!-- ${prefix}-end -->`,\n\t};\n\n\tconst { startIndex, endIndex } = markers;\n\tconst hasValidMarkers =\n\t\tstartIndex !== null && endIndex !== null && startIndex < endIndex;\n\n\tif (hasValidMarkers) {\n\t\ttree.children.splice(\n\t\t\tstartIndex,\n\t\t\tendIndex - startIndex + 1,\n\t\t\tstartMarkerNode,\n\t\t\ttable,\n\t\t\tendMarkerNode,\n\t\t);\n\t} else {\n\t\ttree.children.push(startMarkerNode, table, endMarkerNode);\n\t}\n}\n\n/**\n * Remark plugin to generate and update workspace package tables.\n *\n * Looks for HTML comment markers (`<!-- workspace-packages-start -->` and\n * `<!-- workspace-packages-end -->`) in the markdown and replaces the content\n * between them with an updated table of workspace packages.\n *\n * If no markers exist, the table is appended at the end of the file with markers.\n * User-edited descriptions in the description column are preserved across updates.\n *\n * @example\n * ```typescript\n * import { remark } from \"remark\";\n * import { remarkWorkspacePackages } from \"remark-workspace-packages\";\n *\n * const result = await remark()\n *   .use(remarkWorkspacePackages, { exclude: [\"@internal/*\"] })\n *   .process(markdown);\n * ```\n */\nexport const remarkWorkspacePackages: Plugin<\n\t[WorkspacePackagesOptions?],\n\tRoot\n> = (options) => {\n\tconst {\n\t\tworkspaceRoot: workspaceRootOption,\n\t\tsectionPrefix = \"workspace-packages\",\n\t\texclude = [],\n\t\tinclude = [],\n\t\tincludePrivate = true,\n\t\tincludeLinks = true,\n\t\tcolumns = [\"name\", \"description\"],\n\t\tcolumnHeaders = {},\n\t} = options ?? {};\n\n\tconst mergedColumnHeaders: Record<ColumnType, string> = {\n\t\tname: columnHeaders.name ?? \"Package\",\n\t\tdescription: columnHeaders.description ?? \"Description\",\n\t\tpath: columnHeaders.path ?? \"Path\",\n\t\tprivate: columnHeaders.private ?? \"Private\",\n\t};\n\n\treturn (tree: Root, file: VFile) => {\n\t\tconst filePath = file.history?.[0] ?? file.path;\n\t\tif (!filePath) {\n\t\t\tfile.message(\n\t\t\t\t\"No file path available, skipping workspace packages generation\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst dir = dirname(filePath);\n\t\tconst workspaceRoot = workspaceRootOption\n\t\t\t? join(dir, workspaceRootOption)\n\t\t\t: resolveWorkspaceRoot(dir);\n\n\t\tif (!workspaceRoot) {\n\t\t\tfile.message(\n\t\t\t\t\"No workspace root found, skipping package table generation\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst packages = extractWorkspacePackages(workspaceRoot, {\n\t\t\texclude,\n\t\t\tinclude,\n\t\t\tincludePrivate,\n\t\t});\n\n\t\tif (packages.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst markers = findMarkers(tree, sectionPrefix);\n\t\tconst { startIndex, endIndex } = markers;\n\n\t\tconst existingDescriptions =\n\t\t\tstartIndex !== null && endIndex !== null && startIndex < endIndex\n\t\t\t\t? parseExistingTable(tree, startIndex, endIndex)\n\t\t\t\t: new Map<string, string>();\n\n\t\tconst table = generateTableAst(packages, existingDescriptions, {\n\t\t\tcolumns,\n\t\t\tcolumnHeaders: mergedColumnHeaders,\n\t\t\tincludeLinks,\n\t\t});\n\n\t\tupdateAst(tree, table, sectionPrefix, markers);\n\t};\n};\n"]}