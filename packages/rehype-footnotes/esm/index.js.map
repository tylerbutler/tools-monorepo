{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Footnotes processing utilities for integrating with Littlefoot.js\n * Transforms GFM footnotes to be compatible with Littlefoot's expected format\n */\n\nimport type { Element, Root } from \"hast\";\nimport { visit } from \"unist-util-visit\";\n\n/**\n * Configuration options for footnote processing\n */\nexport interface FootnoteOptions {\n\t/** CSS selector for footnote references (default: 'sup[id^=\"user-content-fnref-\"]') */\n\treferenceSelector?: string;\n\t/** CSS selector for footnote definitions (default: 'section[data-footnotes]') */\n\tdefinitionSelector?: string;\n\t/** Whether to activate littlefoot automatically (default: true) */\n\tactivateOnLoad?: boolean;\n\t/** Littlefoot.js options to pass through */\n\tlittlefootOptions?: {\n\t\tallowDuplicates?: boolean;\n\t\tallowMultiple?: boolean;\n\t\tanchorParentSelector?: string;\n\t\tanchorPattern?: RegExp;\n\t\tdismissDelay?: number;\n\t\tdismissOnUnhover?: boolean;\n\t\tfootnoteSelector?: string;\n\t\thoverDelay?: number;\n\t\tnumberResetSelector?: string;\n\t\tscope?: string;\n\t\t// biome-ignore lint/suspicious/noExplicitAny: Littlefoot.js accepts arbitrary options\n\t\t[key: string]: any;\n\t};\n}\n\n/**\n * Default options for footnote processing\n */\nconst defaultOptions: Required<FootnoteOptions> = {\n\treferenceSelector: 'sup[id^=\"user-content-fnref-\"]',\n\tdefinitionSelector: \"section[data-footnotes]\",\n\tactivateOnLoad: true,\n\tlittlefootOptions: {\n\t\tallowDuplicates: false,\n\t\tallowMultiple: false,\n\t\tdismissDelay: 100,\n\t\tdismissOnUnhover: true,\n\t\thoverDelay: 250,\n\t\tscope: \"body\",\n\t},\n};\n\n/**\n * Transforms GFM footnotes in HAST to be compatible with Littlefoot.js\n * This function modifies the HTML AST to ensure footnotes work with Littlefoot\n *\n * @param tree - HAST tree to transform\n * @param options - Configuration options\n */\nexport function transformFootnotesForLittlefoot(\n\ttree: Root,\n\toptions: FootnoteOptions = {},\n): void {\n\tconst _opts = { ...defaultOptions, ...options };\n\n\t// Track footnote references and definitions\n\tconst footnoteMap = new Map<string, { ref: Element; def: Element }>();\n\n\t// First pass: find all footnote references\n\tvisit(tree, \"element\", (node: Element) => {\n\t\t// Look for sup elements containing links with footnote references\n\t\tif (\n\t\t\tnode.tagName === \"sup\" &&\n\t\t\tnode.children[0] &&\n\t\t\tnode.children[0].type === \"element\" &&\n\t\t\tnode.children[0].tagName === \"a\"\n\t\t) {\n\t\t\tconst linkElement = node.children[0] as Element;\n\n\t\t\t// Check if this is a footnote reference link\n\t\t\tif (\n\t\t\t\tlinkElement.properties?.[\"id\"] &&\n\t\t\t\ttypeof linkElement.properties[\"id\"] === \"string\" &&\n\t\t\t\tlinkElement.properties[\"id\"].startsWith(\"user-content-fnref-\")\n\t\t\t) {\n\t\t\t\tconst footnoteId = linkElement.properties[\"id\"].replace(\n\t\t\t\t\t\"user-content-fnref-\",\n\t\t\t\t\t\"\",\n\t\t\t\t);\n\n\t\t\t\t// Add rel=\"footnote\" for Littlefoot recognition\n\t\t\t\t// Use kebab-case for standard HTML attributes\n\t\t\t\tlinkElement.properties[\"rel\"] = \"footnote\";\n\t\t\t\tlinkElement.properties[\"data-footnote-id\"] = footnoteId;\n\n\t\t\t\t// Store for mapping with definition\n\t\t\t\tif (footnoteMap.has(footnoteId)) {\n\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: Map.has() guarantees entry exists\n\t\t\t\t\tfootnoteMap.get(footnoteId)!.ref = node;\n\t\t\t\t} else {\n\t\t\t\t\t// biome-ignore lint/suspicious/noExplicitAny: Placeholder for paired definition element\n\t\t\t\t\tfootnoteMap.set(footnoteId, { ref: node, def: null as any });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t// Second pass: find footnote definitions and transform them\n\tvisit(tree, \"element\", (node: Element) => {\n\t\t// Match section with dataFootnotes property (camelCase in HAST)\n\t\tif (\n\t\t\tnode.tagName === \"section\" &&\n\t\t\tnode.properties?.[\"dataFootnotes\"] !== undefined\n\t\t) {\n\t\t\t// Find all footnote list items within this section\n\t\t\tvisit(node, \"element\", (listItem: Element) => {\n\t\t\t\tif (\n\t\t\t\t\tlistItem.tagName === \"li\" &&\n\t\t\t\t\tlistItem.properties?.[\"id\"] &&\n\t\t\t\t\ttypeof listItem.properties[\"id\"] === \"string\" &&\n\t\t\t\t\tlistItem.properties[\"id\"].startsWith(\"user-content-fn-\")\n\t\t\t\t) {\n\t\t\t\t\tconst footnoteId = listItem.properties[\"id\"].replace(\n\t\t\t\t\t\t\"user-content-fn-\",\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t);\n\n\t\t\t\t\t// Transform for Littlefoot compatibility\n\t\t\t\t\tlistItem.properties[\"id\"] = `fn:${footnoteId}`;\n\t\t\t\t\tlistItem.properties[\"data-footnote-id\"] = footnoteId;\n\n\t\t\t\t\t// Remove the back-reference link (â†©) as Littlefoot handles this\n\t\t\t\t\t// Match dataFootnoteBackref property (camelCase in HAST)\n\t\t\t\t\tvisit(listItem, \"element\", (backRef: Element, index, parent) => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tbackRef.tagName === \"a\" &&\n\t\t\t\t\t\t\tbackRef.properties?.[\"dataFootnoteBackref\"] !== undefined &&\n\t\t\t\t\t\t\tparent &&\n\t\t\t\t\t\t\ttypeof index === \"number\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tparent.children.splice(index, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Store for mapping\n\t\t\t\t\tif (footnoteMap.has(footnoteId)) {\n\t\t\t\t\t\t// biome-ignore lint/style/noNonNullAssertion: Map.has() guarantees entry exists\n\t\t\t\t\t\tfootnoteMap.get(footnoteId)!.def = listItem;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// biome-ignore lint/suspicious/noExplicitAny: Placeholder for paired reference element\n\t\t\t\t\t\tfootnoteMap.set(footnoteId, { ref: null as any, def: listItem });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n}\n\n/**\n * Generates the Littlefoot.js initialization script\n *\n * @param options - Configuration options\n * @returns JavaScript code as a string\n */\nexport function generateLittlefootScript(\n\toptions: FootnoteOptions = {},\n): string {\n\tconst opts = {\n\t\t...defaultOptions,\n\t\t...options,\n\t\tlittlefootOptions: {\n\t\t\t...defaultOptions.littlefootOptions,\n\t\t\t...(options.littlefootOptions || {}),\n\t\t},\n\t};\n\n\tconst littlefootConfig = JSON.stringify(opts.littlefootOptions, null, 2);\n\n\treturn `\n// Initialize Littlefoot.js for interactive footnotes\nimport { littlefoot } from 'littlefoot';\n\nfunction initializeLittlefoot() {\n  littlefoot(${littlefootConfig});\n}\n\n// Initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', initializeLittlefoot);\n} else {\n  initializeLittlefoot();\n}\n`.trim();\n}\n\n/**\n * Generates the CSS imports needed for Littlefoot.js\n *\n * @returns CSS import statements\n */\nexport function generateLittlefootCSS(): string {\n\treturn `\n/* Littlefoot.js CSS for interactive footnotes */\nimport 'littlefoot/dist/littlefoot.css';\n\n/* Optional: Custom footnote styling */\n.littlefoot-footnote__wrapper {\n  max-width: 400px;\n}\n\n.littlefoot-footnote__content {\n  font-size: 0.9em;\n  line-height: 1.4;\n}\n\n/* Style footnote references */\na[rel=\"footnote\"] {\n  text-decoration: none;\n  color: #0066cc;\n  font-weight: 500;\n}\n\na[rel=\"footnote\"]:hover {\n  text-decoration: underline;\n}\n`.trim();\n}\n\n/**\n * Creates a rehype plugin for processing footnotes with Littlefoot.js\n *\n * @param options - Configuration options\n * @returns Rehype plugin function\n */\nexport function rehypeFootnotes(options: FootnoteOptions = {}) {\n\treturn (tree: Root) => {\n\t\ttransformFootnotesForLittlefoot(tree, options);\n\t};\n}\n"]}