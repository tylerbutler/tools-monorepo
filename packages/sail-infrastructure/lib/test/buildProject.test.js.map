{"version":3,"file":"buildProject.test.js","sourceRoot":"","sources":["../../src/test/buildProject.test.ts"],"names":[],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) Microsoft Corporation and contributors. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { strict as assert } from \"node:assert\";\n\nimport { expect } from \"chai\";\nimport * as chai from \"chai\";\nimport assertArrays from \"chai-arrays\";\nimport { describe, it } from \"mocha\";\n\nimport { loadBuildProject } from \"../buildProject.js\";\nimport { findGitRootSync } from \"../git.js\";\nimport type { ReleaseGroupName, WorkspaceName } from \"../types.js\";\n\nimport { testRepoRoot } from \"./init.js\";\n\nchai.use(assertArrays);\n\ndescribe(\"loadBuildProject\", () => {\n\tdescribe(\"testRepo\", () => {\n\t\tit(\"loads correctly\", () => {\n\t\t\tconst repo = loadBuildProject(testRepoRoot);\n\t\t\tassert.strictEqual(\n\t\t\t\trepo.workspaces.size,\n\t\t\t\t2,\n\t\t\t\t`Expected 2 workspaces, found ${repo.workspaces.size}`,\n\t\t\t);\n\n\t\t\tconst main = repo.workspaces.get(\"main\" as WorkspaceName);\n\t\t\texpect(main).to.not.be.undefined;\n\t\t\texpect(main?.packages.length).to.equal(\n\t\t\t\t9,\n\t\t\t\t\"main workspace has the wrong number of packages\",\n\t\t\t);\n\t\t\texpect(main?.releaseGroups.size).to.equal(\n\t\t\t\t3,\n\t\t\t\t\"main workspace has the wrong number of release groups\",\n\t\t\t);\n\n\t\t\tconst mainReleaseGroup = repo.releaseGroups.get(\"main\" as ReleaseGroupName);\n\t\t\texpect(mainReleaseGroup).to.not.be.undefined;\n\t\t\texpect(mainReleaseGroup?.packages.length).to.equal(\n\t\t\t\t5,\n\t\t\t\t\"main release group has the wrong number of packages\",\n\t\t\t);\n\n\t\t\tconst second = repo.workspaces.get(\"second\" as WorkspaceName);\n\t\t\texpect(second).to.not.be.undefined;\n\t\t\texpect(second?.packages.length).to.equal(\n\t\t\t\t3,\n\t\t\t\t\"second workspace has the wrong number of packages\",\n\t\t\t);\n\t\t\texpect(second?.releaseGroups.size).to.equal(\n\t\t\t\t1,\n\t\t\t\t\"second workspace has the wrong number of release groups\",\n\t\t\t);\n\t\t});\n\n\t\tit(\"releaseGroupDependencies\", async () => {\n\t\t\tconst repo = loadBuildProject(testRepoRoot);\n\t\t\tconst mainReleaseGroup = repo.releaseGroups.get(\"main\" as ReleaseGroupName);\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- test data (validated by another test) guarantees this has a value\n\t\t\tconst actualDependencies = mainReleaseGroup!.releaseGroupDependencies;\n\t\t\tconst names = actualDependencies.map((r) => r.name as string);\n\n\t\t\texpect(actualDependencies).to.not.be.undefined;\n\t\t\texpect(names).to.be.containingAllOf([\"group2\"]);\n\t\t});\n\t});\n\n\tdescribe(\"FluidFramework repo - tests backCompat config loading\", () => {\n\t\tit(\"loads correctly\", () => {\n\t\t\t// Load the root config\n\t\t\tconst repo = loadBuildProject(findGitRootSync());\n\t\t\texpect(repo.workspaces.size).to.be.greaterThan(1);\n\n\t\t\tconst client = repo.workspaces.get(\"client\" as WorkspaceName);\n\t\t\texpect(client).to.not.be.undefined;\n\t\t\texpect(client?.packages.length).to.be.greaterThan(1);\n\t\t\texpect(client?.releaseGroups.size).to.be.greaterThan(0);\n\n\t\t\tconst buildTools = repo.workspaces.get(\"build-tools\" as WorkspaceName);\n\t\t\texpect(buildTools).to.not.be.undefined;\n\t\t\texpect(buildTools?.packages.length).to.equal(\n\t\t\t\t6,\n\t\t\t\t\"build-tools workspace has the wrong number of packages\",\n\t\t\t);\n\t\t\texpect(buildTools?.releaseGroups.size).to.equal(\n\t\t\t\t1,\n\t\t\t\t\"build-tools workspace has the wrong number of release groups\",\n\t\t\t);\n\t\t});\n\n\t\tit(\"releaseGroupDependencies\", async () => {\n\t\t\tconst repo = loadBuildProject(findGitRootSync());\n\t\t\tconst clientReleaseGroup = repo.releaseGroups.get(\"client\" as ReleaseGroupName);\n\t\t\tassert(clientReleaseGroup !== undefined);\n\n\t\t\texpect(() => clientReleaseGroup.releaseGroupDependencies).not.to.throw(\n\t\t\t\t/Key.*? is already set and cannot be modified/,\n\t\t\t);\n\n\t\t\ttry {\n\t\t\t\tconst actualDependencies = clientReleaseGroup.releaseGroupDependencies;\n\n\t\t\t\texpect(actualDependencies).to.not.be.undefined;\n\t\t\t\texpect(actualDependencies).to.not.be.empty;\n\t\t\t} catch (error) {\n\t\t\t\texpect(error).to.match(/111/);\n\t\t\t}\n\t\t});\n\t});\n});\n"]}