{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "ccl-test-flat-format",
  "title": "CCL Test Flat Format",
  "description": "Schema for existing generated flat test files",
  "type": "object",
  "required": ["$schema", "tests"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "tests": {
      "type": "array",
      "minItems": 1,
      "items": {
    "type": "object",
    "required": ["name", "inputs", "validation", "expected", "behaviors", "variants", "features"],
    "allOf": [
      {
        "if": {
          "properties": {
            "validation": {
              "enum": ["get_string", "get_int", "get_bool", "get_float", "get_list"]
            }
          }
        },
        "then": {
          "required": ["args"]
        }
      }
    ],
    "properties": {
      "name": {
        "type": "string",
        "description": "Unique test name (source_name + validation function)",
        "pattern": "^[a-zA-Z0-9_]+$"
      },
      "inputs": {
        "type": "array",
        "description": "CCL input text(s) to be tested. Single-input tests use a 1-element array.",
        "items": { "type": "string" },
        "minItems": 1
      },
      "validation": {
        "type": "string",
        "description": "Single CCL function to validate",
        "enum": [
          "parse", "parse_indented", "filter", "compose",
          "build_hierarchy", "get_string", "get_int", "get_bool", "get_float", "get_list",
          "print", "canonical_format", "load", "round_trip",
          "compose_associative", "identity_left", "identity_right"
        ]
      },
      "expected": {
        "type": "object",
        "description": "Expected result in standardized format",
        "required": ["count"],
        "properties": {
          "count": {
            "type": "integer",
            "description": "Number of expected results/assertions",
            "minimum": 0
          },
          "entries": {
            "type": "array",
            "description": "Expected entries for parse functions",
            "items": {
              "type": "object",
              "required": ["key", "value"],
              "properties": {
                "key": {"type": "string"},
                "value": {"type": "string"}
              },
              "additionalProperties": false
            }
          },
          "object": {
            "description": "Expected object for hierarchy functions"
          },
          "value": {
            "description": "Expected single value for typed access functions"
          },
          "list": {
            "type": "array",
            "description": "Expected list for list access functions"
          },
          "text": {
            "type": "string",
            "description": "Expected text output for print function"
          },
          "boolean": {
            "type": "boolean",
            "description": "Expected boolean result for algebraic property tests"
          },
          "error": {
            "type": "boolean",
            "description": "Whether this should produce an error",
            "default": false
          }
        },
        "additionalProperties": false
      },
      "args": {
        "type": "array",
        "description": "Arguments for typed access functions (get_string, get_int, get_bool, get_float, get_list). Required for these functions, omitted for others.",
        "items": {
          "type": "string"
        }
      },
      "functions": {
        "type": "array",
        "description": "CCL functions tested by this test",
        "items": {
          "type": "string",
          "enum": [
            "parse", "parse_indented", "filter", "compose",
            "build_hierarchy", "get_string", "get_int", "get_bool", "get_float", "get_list",
            "print", "canonical_format", "load", "round_trip",
            "compose_associative", "identity_left", "identity_right"
          ]
        }
      },
      "behaviors": {
        "type": "array",
        "description": "Implementation behavior choices",
        "items": {
          "type": "string",
          "enum": [
            "boolean_strict", "boolean_lenient",
            "crlf_preserve_literal", "crlf_normalize_to_lf",
            "tabs_preserve", "tabs_to_spaces",
            "strict_spacing", "loose_spacing",
            "list_coercion_enabled", "list_coercion_disabled",
            "array_order_insertion", "array_order_lexicographic"
          ]
        },
        "uniqueItems": true
      },
      "variants": {
        "type": "array",
        "description": "Specification variants",
        "items": {
          "type": "string",
          "enum": ["proposed_behavior", "reference_compliant"]
        },
        "uniqueItems": true
      },
      "features": {
        "type": "array",
        "description": "Required language features",
        "items": {
          "type": "string",
          "oneOf": [
            {
              "enum": [
                "comments", "empty_keys",
                "multiline", "unicode", "whitespace"
              ]
            },
            {
              "pattern": "^experimental_"
            },
            {
              "pattern": "^optional_"
            }
          ]
        },
        "uniqueItems": true
      },
      "conflicts": {
        "type": ["object", "null"],
        "description": "Mutually exclusive options by category",
        "properties": {
          "functions": {
            "type": "array",
            "items": {"type": "string"}
          },
          "behaviors": {
            "type": "array",
            "items": {"type": "string"}
          },
          "variants": {
            "type": "array",
            "items": {"type": "string"}
          },
          "features": {
            "type": "array",
            "items": {"type": "string"}
          }
        },
        "additionalProperties": false
      },
      "requires": {
        "type": "array",
        "description": "Functions that must be implemented as prerequisites",
        "items": {
          "type": "string"
        }
      },
      "source_test": {
        "type": "string",
        "description": "Original source test name for traceability"
      },
      "expect_error": {
        "type": "boolean",
        "description": "Whether this test should produce an error",
        "default": false
      },
      "error_type": {
        "type": "string",
        "description": "Expected error type for error tests"
      }
    },
    "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}