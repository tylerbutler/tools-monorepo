# Development Guide - @tylerbu/levee-driver

## Protocol Schema Synchronization

The TypeScript types in `src/generated/protocol-types.ts` are auto-generated from Gleam protocol types defined in the Levee server. **Do not edit this file manually.**

### Schema Architecture

```
levee/levee_protocol/src/levee_protocol/schema.gleam  (Source of truth)
                        │
                        ▼ mix generate_schema
levee/priv/protocol-schema.json
                        │
                        ▼ just generate-schema-ts (copies)
tools-monorepo/packages/levee-driver/schemas/protocol-schema.json
                        │
                        ▼ pnpm build:types
tools-monorepo/packages/levee-driver/src/generated/protocol-types.ts
```

### Updating the Protocol Schema

When the Levee server protocol types change, follow these steps:

**1. In the `levee/` directory (Levee server):**
```bash
# Regenerate JSON schema from Gleam types and copy to levee-driver
just generate-schema-ts
```

This runs `mix generate_schema` to generate `priv/protocol-schema.json` from the Gleam definitions, then copies it to `tools-monorepo/packages/levee-driver/schemas/`.

**2. In the `tools-monorepo/packages/levee-driver/` directory:**
```bash
# Regenerate TypeScript types from JSON schema
pnpm build:types
```

This runs `json2ts` to convert the JSON schema to TypeScript interfaces.

### Key Files

| Location | File | Purpose |
|----------|------|---------|
| Levee server | `levee_protocol/src/levee_protocol/schema.gleam` | Gleam type definitions (source of truth) |
| Levee server | `lib/mix/tasks/generate_schema.ex` | Mix task to generate JSON schema |
| Levee server | `priv/protocol-schema.json` | Generated JSON schema |
| This package | `schemas/protocol-schema.json` | Copied JSON schema |
| This package | `src/generated/protocol-types.ts` | Generated TypeScript types |

### When to Update

Update the protocol schema when:
- New message types are added to the Levee protocol
- Existing message fields change (added, removed, type changes)
- Server contract updates require client changes
