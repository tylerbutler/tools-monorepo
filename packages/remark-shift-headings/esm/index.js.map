{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AAkBzC;;;;;;;;GAQG;AACH,MAAM,CAAC,MAAM,mBAAmB,GAA6B,CAAC,OAAO,EAAE,EAAE;IACxE,MAAM,EACL,sBAAsB,GAAG,CAAC,EAC1B,gBAAgB,GAAG,CAAC,EACpB,QAAQ,GAAG,CAAC,GACZ,GAAG,OAAO,IAAI,EAAE,CAAC;IAElB,OAAO,CAAC,IAAU,EAAE,IAAW,EAAE,EAAE;QAClC,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAiB,CAAC;QAExC,sDAAsD;QACtD,MAAM,gBAAgB,GAAG,QAAQ,CAAC,KAAK,EAAE,WAAW,EAAE,iBAAiB,CAAC;QAExE,2EAA2E;QAC3E,MAAM,YAAY,GAAG,QAAQ,CAAC,iBAAiB,CAAC;QAEhD,6DAA6D;QAC7D,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;QACzC,MAAM,YAAY,GAAG,uCAAuC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAE5E,qEAAqE;QACrE,MAAM,gBAAgB,GACrB,gBAAgB;YAChB,YAAY;YACZ,CAAC,YAAY,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC;QAE5D,uDAAuD;QACvD,IAAI,gBAAgB,KAAK,CAAC;YAAE,OAAO;QAEnC,4CAA4C;QAC5C,IAAI,QAAQ,GAAG,QAAQ,CAAC;QACxB,KAAK,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC,IAAa,EAAE,EAAE;YACxC,IAAI,IAAI,CAAC,KAAK,GAAG,QAAQ,EAAE,CAAC;gBAC3B,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC;YACvB,CAAC;QACF,CAAC,CAAC,CAAC;QAEH,sCAAsC;QACtC,IAAI,QAAQ,KAAK,QAAQ;YAAE,OAAO;QAElC,gCAAgC;QAChC,MAAM,OAAO,GAAG,gBAAgB,GAAG,QAAQ,CAAC;QAE5C,0BAA0B;QAC1B,IAAI,OAAO,KAAK,CAAC;YAAE,OAAO;QAE1B,8BAA8B;QAC9B,KAAK,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC,IAAa,EAAE,EAAE;YACxC,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC;YACtC,qDAAqD;YACrD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAMjD,CAAC;QACN,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC;AACH,CAAC,CAAC","sourcesContent":["import type { Heading, Root } from \"mdast\";\nimport type { Plugin } from \"unified\";\nimport { visit } from \"unist-util-visit\";\nimport type { VFile } from \"vfile\";\n\ninterface Options {\n\tdefaultCollectionLevel?: number;\n\tdefaultPageLevel?: number;\n\tmaxLevel?: number;\n}\n\ninterface AstroData {\n\tastro?: {\n\t\tfrontmatter?: {\n\t\t\theadingStartLevel?: number;\n\t\t};\n\t};\n\theadingStartLevel?: number;\n}\n\n/**\n * Remark plugin to shift heading levels based on context\n *\n * By default, content collection pages (articles, projects) start at h2\n * since their titles are h1 in the layout. Other pages start at h1.\n *\n * Override behavior via frontmatter:\n *   headingStartLevel: 3  # Force highest heading to be h3\n */\nexport const remarkShiftHeadings: Plugin<[Options?], Root> = (options) => {\n\tconst {\n\t\tdefaultCollectionLevel = 2,\n\t\tdefaultPageLevel = 1,\n\t\tmaxLevel = 6,\n\t} = options || {};\n\n\treturn (tree: Root, file: VFile) => {\n\t\tconst fileData = file.data as AstroData;\n\n\t\t// Strategy 1: Check frontmatter for explicit override\n\t\tconst frontmatterLevel = fileData.astro?.frontmatter?.headingStartLevel;\n\n\t\t// Strategy 2: Check if rendering context was set (for Container API usage)\n\t\tconst contextLevel = fileData.headingStartLevel;\n\n\t\t// Strategy 3: Auto-detect content collections from file path\n\t\tconst filePath = file.history?.[0] || \"\";\n\t\tconst isCollection = /\\/src\\/content\\/(articles|projects)\\//.test(filePath);\n\n\t\t// Determine target start level (frontmatter > context > auto-detect)\n\t\tconst targetStartLevel =\n\t\t\tfrontmatterLevel ??\n\t\t\tcontextLevel ??\n\t\t\t(isCollection ? defaultCollectionLevel : defaultPageLevel);\n\n\t\t// Skip shifting if target is h1 (no adjustment needed)\n\t\tif (targetStartLevel === 1) return;\n\n\t\t// Find minimum heading level in the content\n\t\tlet minLevel = Infinity;\n\t\tvisit(tree, \"heading\", (node: Heading) => {\n\t\t\tif (node.depth < minLevel) {\n\t\t\t\tminLevel = node.depth;\n\t\t\t}\n\t\t});\n\n\t\t// No headings found, nothing to shift\n\t\tif (minLevel === Infinity) return;\n\n\t\t// Calculate shift amount needed\n\t\tconst shiftBy = targetStartLevel - minLevel;\n\n\t\t// Skip if no shift needed\n\t\tif (shiftBy === 0) return;\n\n\t\t// Apply shift to all headings\n\t\tvisit(tree, \"heading\", (node: Heading) => {\n\t\t\tconst newLevel = node.depth + shiftBy;\n\t\t\t// Ensure level stays within valid range (1-maxLevel)\n\t\t\tnode.depth = Math.max(1, Math.min(newLevel, maxLevel)) as\n\t\t\t\t| 1\n\t\t\t\t| 2\n\t\t\t\t| 3\n\t\t\t\t| 4\n\t\t\t\t| 5\n\t\t\t\t| 6;\n\t\t});\n\t};\n};\n"]}